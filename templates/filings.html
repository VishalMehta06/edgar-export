<!doctype html>
<html>
<head>
  <title>SEC Filings Exporter - {{ ticker }}</title>
  <script src="/static/app.js" defer></script>
  <style>
	* {
	  box-sizing: border-box;
	}

	body {
	  margin: 0;
	  font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;
	  background: #f3f4f6;
	}

	/* Top Bar */
	.topbar {
	  background: #1f2937;
	  color: white;
	  padding: 16px 24px;
	  display: flex;
	  align-items: center;
	  justify-content: space-between;
	  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
	  border-bottom: 1px solid #374151;
	  position: sticky;
	  top: 0;
	  z-index: 100;
	}

	.topbar h1 {
	  margin: 0;
	  font-size: 20px;
	  font-weight: 600;
	  letter-spacing: -0.3px;
	}

	.ticker-input-container {
	  display: flex;
	  gap: 8px;
	  align-items: center;
	}

	.ticker-input-container input {
	  padding: 8px 12px;
	  border: 1px solid #4b5563;
	  border-radius: 4px;
	  background: #374151;
	  color: white;
	  font-size: 14px;
	  text-transform: uppercase;
	  min-width: 120px;
	  font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;
	}

	.ticker-input-container input::placeholder {
	  color: #9ca3af;
	}

	.ticker-input-container input:focus {
	  outline: none;
	  background: #4b5563;
	  border-color: #6b7280;
	}

	.ticker-input-container input[type="number"] {
	  padding: 8px 8px;
	  border: 1px solid #4b5563;
	  border-radius: 4px;
	  background: #374151;
	  color: white;
	  font-size: 14px;
	  width: 64px;
	  font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;
	  -moz-appearance: textfield;
	}

	.ticker-input-container input[type="number"]::-webkit-outer-spin-button,
	.ticker-input-container input[type="number"]::-webkit-inner-spin-button {
	  -webkit-appearance: none;
	}

	.ticker-input-container input[type="number"]:focus {
	  outline: none;
	  background: #4b5563;
	  border-color: #6b7280;
	}

	.years-label {
	  color: #9ca3af;
	  font-size: 13px;
	  white-space: nowrap;
	}

	.ticker-input-container button {
	  padding: 8px 16px;
	  background: #6b7280;
	  color: white;
	  border: none;
	  border-radius: 4px;
	  font-weight: 500;
	  cursor: pointer;
	  transition: background 0.15s;
	  font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;
	  font-size: 14px;
	}

	.ticker-input-container button:hover {
	  background: #4b5563;
	}

	.current-ticker {
	  background: #374151;
	  padding: 6px 12px;
	  border-radius: 4px;
	  font-weight: 600;
	  margin-left: 12px;
	  border: 1px solid #4b5563;
	  font-size: 14px;
	}

	.user-info-top {
	  color: #e5e7eb;
	  font-size: 13px;
	}

	.logout-link-top {
	  color: #d1d5db;
	  text-decoration: none;
	  font-weight: 500;
	}

	.logout-link-top:hover {
	  color: white;
	  text-decoration: underline;
	}

	/* Main Content */
	.content {
	  padding: 24px;
	}

	.table-container {
	  overflow-x: auto;
	}

	.table-wrapper {
	  min-width: fit-content;
	}

	/*Base Table Style*/
    table { 
		border-collapse: collapse; 
		width: 100%; 
		background: white; 
		border-radius: 4px; 
		overflow: hidden;
		border: 1px solid #d1d5db;
	}
    th, td { border: 1px solid #e5e7eb; vertical-align: top; padding: 10px; }
    .report { cursor: pointer; color: #374151; margin-bottom: 4px; }
    .report:hover { text-decoration: underline; }
    .category { font-weight: bold; margin-top: 6px; }

	th {
	background: #374151;
	color: white;
	padding: 12px 10px;
	font-weight: 500;
	font-size: 14px;
	}

	td {
	vertical-align: top;
	padding: 12px 10px;
	background: white;
	font-size: 14px;
	}

	td:nth-child(even) {
	background: #f9fafb;
	}

	.category {
	font-weight: 600;
	color: #1f2937;
	margin-top: 8px;
	margin-bottom: 6px;
	padding-bottom: 4px;
	border-bottom: 1px solid #e5e7eb;
	font-size: 13px;
	text-transform: uppercase;
	letter-spacing: 0.3px;
	}

	.report {
	cursor: pointer;
	color: #4b5563;
	margin: 4px 0;
	padding: 2px 0;
	font-weight: 400;
	}

	.report:hover {
	color: #1f2937;
	text-decoration: underline;
	}

	.report.exported {
	color: #059669;
	font-weight: 500;
	cursor: default;
	}

	/* Multiselect Style */
	#filters {
	margin: 0;
	padding: 14px 24px;
	background: white;
	border-bottom: 1px solid #d1d5db;
	position: sticky;
	top: 53px;
	z-index: 99;
	box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
	}

	#filters strong {
		color: #1f2937;
		font-weight: 500;
		font-size: 14px;
	}

	.filter-option {
	margin-right: 16px;
	cursor: pointer;
	color: #4b5563;
	font-size: 14px;
	}

	.filter-option input {
		margin-right: 4px;
	}

	h2 {
	  margin-top: 0;
	  margin-bottom: 16px;
	  color: #1f2937;
	  font-weight: 600;
	  font-size: 18px;
	  letter-spacing: -0.3px;
	}

	/* Loading overlay */
	#loading-overlay {
	  display: none;
	  position: fixed;
	  inset: 0;
	  background: rgba(243, 244, 246, 0.92);
	  z-index: 200;
	  flex-direction: column;
	  align-items: center;
	  justify-content: center;
	}

	.loader-card {
	  background: white;
	  border: 1px solid #d1d5db;
	  border-radius: 4px;
	  padding: 40px 56px;
	  text-align: center;
	  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
	  min-width: 320px;
	}

	.loader-card h2 {
	  font-size: 20px;
	  font-weight: 600;
	  color: #1f2937;
	  margin: 0 0 6px;
	  letter-spacing: -0.3px;
	}

	.loader-card p {
	  color: #6b7280;
	  font-size: 14px;
	  margin: 0 0 24px;
	}

	.progress-track {
	  background: #e5e7eb;
	  border-radius: 99px;
	  height: 6px;
	  overflow: hidden;
	}

	#progress-bar {
	  height: 100%;
	  width: 0%;
	  background: #374151;
	  border-radius: 99px;
	  transition: width 0.12s ease-out;
	}

</style>
</head>
<body>

<!-- Loading overlay — shown while a new ticker's filings page is loading -->
<div id="loading-overlay">
  <div class="loader-card">
    <h2>Loading <span id="loader-ticker"></span></h2>
    <p>Fetching <span id="loader-years"></span> of filings from SEC EDGAR…</p>
    <div class="progress-track">
      <div id="progress-bar"></div>
    </div>
  </div>
</div>

<div class="topbar">
  <div style="display: flex; align-items: center;">
    <h1> <a href="{{ url_for('home') }}" 
			style="text-decoration: none; color: inherit;"> 
			SEC Filings Exporter </a> </h1>
    <span class="current-ticker">{{ ticker }}</span>
  </div>
  
  <div style="display: flex; align-items: center; gap: 20px;">
    <div class="ticker-input-container">
      <input 
        type="text" 
        id="ticker-change" 
        placeholder="Ticker..." 
		autocomplete="off"
        pattern="[A-Za-z]{1,5}"
      >
      <input
        type="number"
        id="years-change"
        value="{{ years }}"
        min="1"
        max="30"
        title="Years of filings"
      >
      <button onclick="changeTicker()">Go</button>
    </div>
    <div class="user-info-top">
      {{ user_name }} · <a href="/logout" class="logout-link-top">Logout</a>
    </div>
  </div>
</div>

<div id="filters">
  <strong>Filter filings:</strong>
  {% for form in filing_types %}
    <label class="filter-option">
      <input
        type="checkbox"
        value="{{ form }}"
        checked
      >
      {{ form }}
    </label>
  {% endfor %}
</div>

<div class="content">

<h2>Filings</h2>

<div class="table-container">
<div class="table-wrapper">

<table>
  <thead>
    <tr>
      {% for filing in filings %}
        <th data-filing-type="{{ filing.form }}">
		{{ filing.form }}<br>
		{{ filing.filingDate }}
		</th>

      {% endfor %}
    </tr>
  </thead>

  <tbody>
    <tr>
      {% for filing in filings %}
        <td>
          {% for category, reports in filing.reports.items() %}
            <div class="category">{{ category.title() }}</div>

            {% for report in reports %}
              <div
				class="report"
				data-url="{{ report.url }}"
				data-report-name="{{ report.name_short }}"
				data-filing-date="{{ filing.filingDate }}"
				data-filing-type="{{ filing.form }}"
				data-ticker="{{ ticker }}"
				data-category="{{ category }}"
				>
				{{ report.name_short }}
			  </div>

            {% endfor %}
          {% endfor %}
        </td>
      {% endfor %}
    </tr>
  </tbody>
</table>

</div>
</div>

</div>

<script>
function showLoader(ticker, years) {
  document.getElementById('loader-ticker').textContent = ticker;
  document.getElementById('loader-years').textContent =
    `${years} year${years == 1 ? '' : 's'}`;
  document.getElementById('loading-overlay').style.display = 'flex';
  startProgress();
}

function startProgress() {
  const bar = document.getElementById('progress-bar');
  let width = 0;
  // Simulate progress: fast at first, asymptotically approach 60%
  const interval = setInterval(() => {
    const remaining = 60 - width;
    width += remaining * 0.04;
    bar.style.width = Math.min(width, 60) + '%';
    if (width >= 60) clearInterval(interval);
  }, 120);
}

function changeTicker() {
  const input = document.getElementById('ticker-change');
  const ticker = input.value.toUpperCase().trim();
  const years = parseInt(document.getElementById('years-change').value) || 10;
  if (ticker && ticker.match(/^[A-Z]{1,5}$/)) {
    showLoader(ticker, years);
    window.location.href = `/filings/${ticker}?years=${years}`;
  } else {
    alert('Please enter a valid ticker symbol (1-5 letters)');
  }
}

// Allow Enter key to submit from either input
['ticker-change', 'years-change'].forEach(id => {
  document.getElementById(id).addEventListener('keypress', function(e) {
    if (e.key === 'Enter') changeTicker();
  });
});
</script>

</body>
</html>
